{
	"$schema": "https://raw.githubusercontent.com/invoiceradar/plugins/main/schema.json",
	"id": "google-adsense",
	"name": "Google AdSense",
	"description": "With Google AdSense, you can earn money from your online content.",
	"homepage": "https://adsense.google.com",
	"note": "Payments in iFrame",
	"configSchema": {},
	"checkAuth": [
		{
			"action": "navigate",
			"url": "https://www.google.com/adsense"
		},
		{
			"action": "checkElementExists",
			"selector": "as-earnings-card"
		}
	],
	"startAuth": [
		{
			"action": "navigate",
			"url": "https://www.google.com/adsense/login"
		},
		{
			"action": "waitForElement",
			"selector": "as-earnings-card",
			"timeout": 120000
		}
	],
	"getDocuments": [
		{
			"action": "navigate",
			"url": "https://www.google.com/adsense"
		},
		{
			"action": "extract",
			"variable": "uri",
			"fields": {
				"payments": {
					"selector": "a[href$='/payments']",
					"attribute": "href"
				}
			}
		},
		{
			"action": "navigate",
			"url": "https://www.google.com/{{uri.payments}}"
		},
		{
			"action": "waitForNetworkIdle",
			"timeout": 1000
		},
		{
			"action": "extract",
			"variable": "iframe",
			"fields": {
				"url": {
					"selector": "#zoned-embedded-portal-containerIframe",
					"attribute": "src"
				}
			}
		},
		{
			"action": "navigate",
			"url": "{{iframe.url}}"
		},
		{
			"action": "waitForNetworkIdle",
			"timeout": 1000
		},
		{
			"action": "click",
			"selector": "div[class$='action-bar-links'] a"
		},
		{
			"action": "waitForNetworkIdle",
			"timeout": 1000
		},
		{
			"action": "extractAll",
			"selector": "table.payment_index tbody tr",
			"variable": "invoice",
			"fields": {
				"id": {
					"selector": "td:nth-child(2)"
				},
				"date": {
					"selector": "td:nth-child(3)"
				},
				"total": {
					"selector": "td:nth-child(4)"
				},
				"url": {
					"selector": "a[title='Download']",
					"attribute": "href"
				}
			},
			"forEach": [
				{
					"action": "downloadPdf",
					"url": "https://publishers.tradedoubler.com{{invoice.url}}",
					"document": {
						"type": "outgoing_invoice",
						"id": "{{invoice.id}}",
						"date": "{{invoice.date}}",
						"total": "{{invoice.total}}"
					}
				}
			]
		}
	]
}
